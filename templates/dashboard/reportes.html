{% extends "dashboard/base.html" %}
{% load static %}
{% block title %}Reportes{% endblock %}
{% block page_title %}Reportes{% endblock %}

{% block content %}
<style>
    .report-hub {
        display: flex;
        flex-direction: column;
        gap: 32px;
    }

    .report-hub__header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 20px;
        align-items: flex-end;
    }

    .report-hub__intro h2 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-text-main);
    }

    .report-hub__intro p {
        margin: 6px 0 0;
        color: var(--color-text-subtle);
        max-width: 520px;
    }

    .report-range-picker {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: flex-end;
        background: var(--color-surface-card);
        border: 1px solid var(--color-border-subtle);
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 16px 32px rgba(var(--color-ink-rgb), 0.08);
    }

    .report-range-picker__field {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .report-range-picker__field label {
        font-weight: 600;
        font-size: 0.85rem;
        color: var(--color-text-subtle);
    }

    .report-range-picker__field input {
        min-width: 180px;
        border: 1px solid var(--color-border-subtle);
        border-radius: 10px;
        padding: 10px 14px;
        font-size: 0.95rem;
        color: var(--color-text-main);
        background: var(--color-surface-soft);
    }

    .btn.btn-outline {
        border: 1px solid var(--color-accent-500);
        color: var(--color-accent-500);
        background: transparent;
        font-weight: 600;
        padding: 10px 18px;
        border-radius: 999px;
        transition: background 0.2s ease, color 0.2s ease;
    }

    .btn.btn-outline:hover {
        background: var(--color-accent-soft);
        color: var(--color-accent-600);
    }

    .report-hub__grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 18px;
    }

    .report-card {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 18px;
        padding: 22px;
        border-radius: 20px;
        background: linear-gradient(135deg, var(--color-surface-card), var(--color-surface-contrast));
        border: 1px solid var(--color-border-subtle);
        box-shadow: 0 20px 40px rgba(var(--color-ink-rgb), 0.08);
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        overflow: hidden;
    }

    .report-card::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top right, rgba(var(--color-accent-500-rgb), 0.18), transparent 55%);
        opacity: 0;
        transition: opacity 0.2s ease;
        pointer-events: none;
    }

    .report-card:hover,
    .report-card:focus {
        transform: translateY(-4px);
        box-shadow: 0 24px 48px rgba(var(--color-ink-rgb), 0.12);
    }

    .report-card:hover::after,
    .report-card:focus::after {
        opacity: 1;
    }

    .report-card--accent {
        background: linear-gradient(135deg, rgba(var(--color-accent-500-rgb), 0.16), rgba(var(--color-accent-deep-rgb), 0.2));
        border-color: rgba(var(--color-accent-deep-rgb), 0.45);
        color: var(--color-text-main);
    }

    .report-card__icon {
        width: 52px;
        height: 52px;
        border-radius: 14px;
        display: grid;
        place-items: center;
        font-size: 1.8rem;
        color: var(--color-accent-500);
        background: rgba(var(--color-accent-500-rgb), 0.12);
    }

    .report-card--accent .report-card__icon {
        color: #fff;
        background: rgba(255, 255, 255, 0.18);
    }

    .report-card__body h3 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 700;
        color: inherit;
    }

    .report-card__body p {
        margin: 6px 0 0;
        color: var(--color-text-subtle);
    }

    .report-card__meta {
        display: flex;
        flex-direction: column;
        gap: 4px;
        color: var(--color-text-subtle);
    }

    .report-card__value {
        font-size: 1.35rem;
        font-weight: 700;
        color: var(--color-text-main);
    }

    .report-card__label {
        font-size: 0.9rem;
    }

    .report-modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        padding: clamp(16px, 4vw, 48px);
        background: rgba(15, 23, 42, 0.42);
        z-index: 1200;
    }

    .report-modal.is-visible {
        display: flex;
    }

    .report-modal__dialog {
        position: relative;
        width: min(1100px, 98vw);
        max-height: 92vh;
        background: #fff;
        border-radius: 22px;
        box-shadow: 0 28px 60px rgba(15, 23, 42, 0.22);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .report-modal__header {
        padding: 22px clamp(20px, 4vw, 32px);
        border-bottom: 1px solid var(--color-border-divider);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
    }

    .report-modal__header h2 {
        margin: 0;
        font-size: 1.35rem;
        font-weight: 700;
        color: var(--color-text-main);
    }

    .report-modal__close {
        border: none;
        background: rgba(var(--color-ink-rgb), 0.05);
        width: 38px;
        height: 38px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        font-size: 1.2rem;
        cursor: pointer;
        color: var(--color-text-main);
    }

    .report-modal__body {
        padding: clamp(20px, 4vw, 32px);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 28px;
    }

    .report-modal__filters {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
    }

    .report-modal__filters label {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--color-text-subtle);
    }

    .report-modal__filters input,
    .report-modal__filters select,
    .report-modal__filters textarea {
        border: 1px solid var(--color-border-subtle);
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 0.95rem;
        background: var(--color-surface-soft);
        color: var(--color-text-main);
    }

    .report-modal__actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        flex-wrap: wrap;
    }

    .report-modal__actions .btn,
    .report-modal__close,
    .report-modal__filters button,
    [data-actions-only] .btn {
        position: relative;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 18px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        border: none;
    }

    .report-modal__actions .btn:focus,
    .report-modal__close:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(var(--color-accent-500-rgb), 0.28);
    }

    .report-modal__actions .btn:hover:not(:disabled),
    .report-modal__close:hover:not(:disabled) {
        transform: translateY(-1px);
    }

    .report-modal__actions .btn.btn-primary {
        background: linear-gradient(135deg, var(--color-accent-500), var(--color-accent-400));
        color: #fff;
        box-shadow: 0 14px 28px rgba(var(--color-accent-500-rgb), 0.22);
    }

    .report-modal__actions .btn.btn-primary:hover {
        box-shadow: 0 18px 34px rgba(var(--color-accent-500-rgb), 0.32);
    }

    .report-modal__actions .btn.btn-secondary {
        background: rgba(var(--color-accent-deep-rgb), 0.08);
        color: var(--color-accent-deep);
    }

    .report-modal__actions .btn.btn-secondary:hover {
        background: rgba(var(--color-accent-deep-rgb), 0.16);
    }

    .report-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
    }

    .report-summary__card {
        border-radius: 16px;
        padding: 16px;
        background: rgba(var(--color-accent-500-rgb), 0.08);
        border: 1px solid rgba(var(--color-accent-500-rgb), 0.2);
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .report-summary__label {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-text-subtle);
        font-weight: 600;
    }

    .report-summary__value {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--color-text-main);
    }

    .report-table-wrapper {
        border: 1px solid var(--color-border-divider);
        border-radius: 16px;
        background: #fff;
        max-height: min(420px, 60vh);
        max-width: 100%;
        overflow-y: auto;
        overflow-x: auto;
    }

    .report-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 680px;
    }

    .report-table th,
    .report-table td {
        padding: 12px 16px;
        border-bottom: 1px solid var(--color-border-divider);
        text-align: left;
        font-size: 0.95rem;
    }

    .report-table th {
        background: var(--color-surface-muted);
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        color: var(--color-text-subtle);
    }

    .report-table tbody tr:hover {
        background: rgba(var(--color-accent-500-rgb), 0.08);
    }

    .report-empty-state {
        border: 1px dashed var(--color-border-subtle);
        border-radius: 16px;
        padding: 32px;
        text-align: center;
        color: var(--color-text-subtle);
        background: rgba(var(--color-accent-500-rgb), 0.08);
    }

    .report-spinner {
        display: none;
        width: 26px;
        height: 26px;
        border-radius: 50%;
        border: 3px solid rgba(var(--color-accent-500-rgb), 0.2);
        border-top-color: var(--color-accent-500);
        animation: spin 0.9s linear infinite;
    }

    .report-modal[data-loading="true"] .report-spinner {
        display: inline-block;
    }

    .report-modal[data-loading="true"] [data-primary-action] {
        pointer-events: none;
        opacity: 0.6;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    @media (max-width: 720px) {
        .report-range-picker {
            width: 100%;
            justify-content: center;
        }

        .report-card {
            padding: 18px;
        }

        .report-modal__dialog {
            border-radius: 18px;
        }
    }
</style>

<section class="report-hub">
    <header class="report-hub__header">
        <div class="report-hub__intro">
            <h2>Panel de reportes</h2>
            <p>Analiza resultados de ventas, inventario y cuotas en un solo lugar.</p>
        </div>
        <div class="report-hub__filters">
            <div class="report-range-picker">
                <div class="report-range-picker__field">
                    <label for="report-range-start">Desde</label>
                    <input id="report-range-start" type="date" data-report-range-start>
                </div>
                <div class="report-range-picker__field">
                    <label for="report-range-end">Hasta</label>
                    <input id="report-range-end" type="date" data-report-range-end>
                </div>
                <button type="button" class="btn btn-outline" data-report-range-apply>Aplicar</button>
            </div>
        </div>
    </header>

    <div class="report-hub__grid">
        <article class="report-card" data-report-trigger="total-sales">
            <div class="report-card__icon">
                <i class="ri-bar-chart-2-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Ventas totales</h3>
                <p>Ingresos, descuentos y trade-in por período.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="total-sales">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Total vendido</span>
            </div>
        </article>

        <article class="report-card" data-report-trigger="sales-cost">
            <div class="report-card__icon">
                <i class="ri-scan-2-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Costo de ventas</h3>
                <p>Valida el costo de las unidades vendidas y las ganancias.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="sales-cost">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Costo total</span>
            </div>
        </article>

        <article class="report-card" data-report-trigger="inventory-cost">
            <div class="report-card__icon">
                <i class="ri-archive-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Costo inventario</h3>
                <p>Valor total del stock que permanece en inventario.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="inventory-cost">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Valor inventario</span>
            </div>
        </article>

        <article class="report-card" data-report-trigger="sales-period">
            <div class="report-card__icon">
                <i class="ri-calendar-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Ventas por periodo</h3>
                <p>Compara ingresos agrupados por día, mes o año.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="sales-period">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Ventas registradas</span>
            </div>
        </article>

        <article class="report-card" data-report-trigger="profit-period">
            <div class="report-card__icon">
                <i class="ri-money-dollar-circle-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Ganancias por periodo</h3>
                <p>Monitorea ingresos y márgenes en cada intervalo.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="profit-period">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Ganancia neta</span>
            </div>
        </article>

        <article class="report-card" data-report-trigger="product-sales">
            <div class="report-card__icon">
                <i class="ri-shopping-basket-2-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Ventas por producto</h3>
                <p>Productos más vendidos, unidades y montos.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="product-sales">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Productos</span>
            </div>
        </article>

        <article class="report-card" data-report-trigger="category-analysis">
            <div class="report-card__icon">
                <i class="ri-pie-chart-2-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Análisis por categoría</h3>
                <p>Inventario y ventas agrupadas por categoría y marca.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="category-analysis">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Categorías</span>
            </div>
        </article>

        <article class="report-card" data-report-trigger="cash-status">
            <div class="report-card__icon">
                <i class="ri-hand-coin-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Estado de caja</h3>
                <p>Sesiones abiertas, montos y diferencias reportadas.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="cash-status">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Sesiones</span>
            </div>
        </article>

        <article class="report-card report-card--accent" data-report-trigger="credit-installments">
            <div class="report-card__icon">
                <i class="ri-file-list-3-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Créditos (Cuotas)</h3>
                <p>Seguimiento de cuentas a crédito, vencimientos y saldos.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="credit-installments">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Créditos activos</span>
            </div>
        </article>

        <article class="report-card" data-report-trigger="expense-control">
            <div class="report-card__icon">
                <i class="ri-money-dollar-circle-line"></i>
            </div>
            <div class="report-card__body">
                <h3>Control de gastos</h3>
                <p>Registra y categoriza los gastos operativos del negocio.</p>
            </div>
            <div class="report-card__meta" data-report-card-summary="expense-control">
                <span class="report-card__value" data-summary-value>—</span>
                <span class="report-card__label">Gastos registrados</span>
            </div>
        </article>
    </div>
</section>

{% include "dashboard/reportes/partials/modal_total_sales.html" %}
{% include "dashboard/reportes/partials/modal_sales_cost.html" %}
{% include "dashboard/reportes/partials/modal_inventory_cost.html" %}
{% include "dashboard/reportes/partials/modal_sales_period.html" %}
{% include "dashboard/reportes/partials/modal_profit_period.html" %}
{% include "dashboard/reportes/partials/modal_product_sales.html" %}
{% include "dashboard/reportes/partials/modal_category_analysis.html" %}
{% include "dashboard/reportes/partials/modal_cash_status.html" %}
{% include "dashboard/reportes/partials/modal_credit_installments.html" %}
{% endblock %}

{% block custom_scripts %}
<script src="{% static 'js/reportes-dashboard.js' %}"></script>
{% endblock %}
